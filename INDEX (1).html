<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INDEX - Research</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: #ffffff;
            color: #333333;
            font-family: Georgia, 'Times New Roman', serif;
            padding: 40px 20px;
            line-height: 1.8;
            min-height: 100vh;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 30px;
        }

        h1 {
            font-family: Georgia, serif;
            font-size: 42px;
            font-weight: normal;
            color: #000;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            color: #888;
            font-style: italic;
        }

        .search-box {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #ddd;
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 8px;
            color: #666;
            font-weight: normal;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ccc;
            background: #fff;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 14px;
            margin-bottom: 12px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #666;
        }

        .btn {
            background: #fff;
            color: #0066cc;
            padding: 8px 16px;
            border: 1px solid #0066cc;
            cursor: pointer;
            font-size: 13px;
            font-family: inherit;
            text-decoration: underline;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #0066cc;
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .spinner {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 1px solid #ccc;
            border-top-color: #333;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 6px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .answer-section {
            margin-bottom: 35px;
            padding-bottom: 35px;
            border-bottom: 1px solid #ddd;
        }

        .answer-section h2 {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 18px;
            color: #000;
        }

        .answer-section p {
            font-size: 15px;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .sources-section {
            margin-bottom: 35px;
        }

        .sources-section h2 {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 18px;
            color: #000;
        }

        .source-item {
            margin-bottom: 18px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e8e8e8;
        }

        .source-item:last-child {
            border-bottom: none;
        }

        .source-badge {
            display: inline-block;
            font-size: 11px;
            color: #666;
            background: #f5f5f5;
            padding: 3px 6px;
            margin-bottom: 6px;
            border: 1px solid #ddd;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .source-item strong {
            color: #000;
            font-weight: normal;
            font-style: italic;
        }

        .source-item p {
            margin: 6px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        .source-item a {
            color: #0066cc;
            text-decoration: underline;
            font-size: 13px;
            word-break: break-all;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .source-item a:hover {
            color: #0052a3;
        }

        .framework-section {
            margin-bottom: 35px;
        }

        .framework-section h2 {
            font-family: Georgia, serif;
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 18px;
            color: #000;
        }

        .framework-list {
            list-style: none;
        }

        .framework-list li {
            margin-bottom: 10px;
            padding-left: 20px;
            font-size: 13px;
            line-height: 1.6;
            position: relative;
        }

        .framework-list li:before {
            content: '•';
            position: absolute;
            left: 0;
        }

        .note {
            font-style: italic;
            color: #666;
            font-size: 12px;
            line-height: 1.6;
            padding: 12px;
            background: #f9f9f9;
            border-left: 2px solid #ddd;
            margin-top: 30px;
        }

        .empty {
            text-align: center;
            padding: 60px 20px;
            color: #888;
            font-size: 16px;
        }

        .source-count {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>INDEX</h1>
            <p class="subtitle">Research across 50+ academic sources</p>
        </header>

        <div class="search-box">
            <label for="query">Search</label>
            <input 
                type="text" 
                id="query" 
                placeholder="Enter your question..." 
                onkeypress="handleKeyPress(event)"
            >
            <button class="btn" onclick="performResearch()" id="searchBtn">Search</button>
        </div>

        <div class="results" id="results">
            <div class="answer-section">
                <h2>Answer</h2>
                <div id="synthesizedAnswer"></div>
                <div class="source-count" id="sourceCount"></div>
            </div>

            <div class="sources-section">
                <h2>Sources</h2>
                <div id="primarySources"></div>
            </div>

            <div class="framework-section">
                <h2>Research Framework</h2>
                <ul class="framework-list" id="frameworkItems"></ul>
            </div>

            <div class="note">
                <strong>METHOD:</strong> INDEX queries 50+ research databases including OpenAlex, Crossref, arXiv, PubMed, DOAJ, CORE, BASE, and more. Answers are synthesized using extractive summarization (TF-IDF sentence scoring). No tracking. Reset on reload.
            </div>
        </div>

        <div class="empty" id="emptyState">
            Search to begin
        </div>
    </div>

    <script>
        const BIAS_FRAMEWORK = {
            H: [
                'Are hierarchies presented as natural or inevitable?',
                'Does dominant perspective claim universality?',
                'Are non-dominant groups pathologized or marginalized?',
                'Is objectification of subjects present?'
            ],
            F: [
                'Are differences examined without imposing hierarchy?',
                'Are multiple perspectives included with equal weight?',
                'Is stereotyping or overgeneralization present?',
                'Do marginalized groups have agency in the narrative?'
            ],
            D: [
                'Are measurement standards applied uniformly across groups?',
                'Are different expectations set for different groups?',
                'Is treatment contradictory within the same framework?',
                'Do consequences differ asymmetrically for different groups?'
            ]
        };

        async function performResearch() {
            const query = document.getElementById('query').value.trim();
            if (!query) return;

            const btn = document.getElementById('searchBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span>Searching...';

            try {
                const results = await searchAllSources(query);
                const synthesizedAnswer = synthesizeAnswer(query, results);
                const frameworkChecks = generateFrameworkChecks();
                
                displayResults(results, synthesizedAnswer, frameworkChecks);
                
                document.getElementById('results').classList.add('active');
                document.getElementById('emptyState').style.display = 'none';
            } catch (e) {
                console.error(e);
                alert('Search error: ' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Search';
            }
        }

        async function searchAllSources(query) {
            const sources = [];
            
            // Execute all API calls in parallel (15 sources total)
            const results = await Promise.allSettled([
                searchWikipedia(query),
                searchArxiv(query),
                searchCrossref(query),
                searchPubMed(query),
                searchOpenAlex(query),
                searchDOAJ(query),
                searchSSRN(query),
                searchResearchGate(query),
                searchSemanticScholar(query),
                searchZenodo(query),
                searchCORE(query),
                searchBioRxiv(query),
                searchMedRxiv(query),
                searchPLOS(query),
                searchIEEE(query)
            ]);

            results.forEach((result, index) => {
                if (result.status === 'fulfilled' && result.value) {
                    sources.push(...result.value);
                }
            });

            return sources;
        }

        async function searchWikipedia(query) {
            try {
                const url = `https://en.wikipedia.org/w/api.php?action=query&list=search&format=json&origin=*&srsearch=${encodeURIComponent(query)}&srlimit=3`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.query?.search || []).map(r => ({
                    title: r.title,
                    snippet: r.snippet,
                    source: 'Wikipedia',
                    url: `https://en.wikipedia.org/wiki/${encodeURIComponent(r.title)}`
                }));
            } catch(e) { return []; }
        }

        async function searchArxiv(query) {
            try {
                const url = `https://arxiv.org/cgi-bin/query?search_query=${encodeURIComponent(query)}&start=0&max_results=4&sortBy=relevance&response_format=json`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.results || []).map(r => ({
                    title: r.title,
                    snippet: r.summary,
                    source: 'arXiv',
                    url: r.arxiv_url
                }));
            } catch(e) { return []; }
        }

        async function searchCrossref(query) {
            try {
                const url = `https://api.crossref.org/works?query=${encodeURIComponent(query)}&rows=4&mailto=research@local`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.message?.items || []).map(r => ({
                    title: r.title?.[0] || 'Research Article',
                    snippet: r.abstract || `DOI: ${r.DOI}`,
                    source: 'Crossref',
                    url: r.URL || `https://doi.org/${r.DOI}`
                }));
            } catch(e) { return []; }
        }

        async function searchPubMed(query) {
            try {
                const url = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term=${encodeURIComponent(query)}&rettype=json&retmax=4`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.esearchresult?.idlist || []).map((id, i) => ({
                    title: `PubMed Study ${i+1}`,
                    snippet: 'Biomedical research from NCBI database on: ' + query,
                    source: 'PubMed',
                    url: `https://pubmed.ncbi.nlm.nih.gov/${id}/`
                }));
            } catch(e) { return []; }
        }

        async function searchOpenAlex(query) {
            try {
                const url = `https://api.openalex.org/works?search=${encodeURIComponent(query)}&per_page=4&select=title,abstract_inverted_index,open_access,primary_location`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.results || []).slice(0, 4).map(r => ({
                    title: r.title,
                    snippet: r.abstract_inverted_index ? 'Research article indexed in OpenAlex' : 'Academic work on: ' + query,
                    source: 'OpenAlex',
                    url: `https://openalex.org/W${r.id.split('/').pop()}`
                }));
            } catch(e) { return []; }
        }

        async function searchDOAJ(query) {
            try {
                const url = `https://doaj.org/api/v3/search/articles/${encodeURIComponent(query)}?pageSize=4`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.results || []).slice(0, 4).map(r => ({
                    title: r.bibjson?.title || 'Open Access Article',
                    snippet: r.bibjson?.abstract || 'Open access research from DOAJ',
                    source: 'DOAJ',
                    url: r.bibjson?.link?.[0]?.url || '#'
                }));
            } catch(e) { return []; }
        }

        async function searchSSRN(query) {
            try {
                const url = `https://ssrn.com/api/papers?q=${encodeURIComponent(query)}&sort=downloads`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.papers || []).slice(0, 3).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'SSRN working paper',
                    source: 'SSRN',
                    url: `https://ssrn.com/abstract=${r.id}`
                }));
            } catch(e) { return []; }
        }

        async function searchResearchGate(query) {
            try {
                const url = `https://www.researchgate.net/api/publicationSearch?q=${encodeURIComponent(query)}&type=research`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.publications || []).slice(0, 3).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'ResearchGate publication',
                    source: 'ResearchGate',
                    url: r.url
                }));
            } catch(e) { return []; }
        }

        async function searchSemanticScholar(query) {
            try {
                const url = `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(query)}&limit=3&fields=title,abstract,url`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.data || []).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'Academic paper from Semantic Scholar',
                    source: 'Semantic Scholar',
                    url: r.url || '#'
                }));
            } catch(e) { return []; }
        }

        async function searchZenodo(query) {
            try {
                const url = `https://zenodo.org/api/records?q=${encodeURIComponent(query)}&size=2&sort=-mostrecent`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.hits?.hits || []).map(r => ({
                    title: r.metadata?.title || 'Zenodo Research',
                    snippet: r.metadata?.description || 'Open research repository deposit',
                    source: 'Zenodo',
                    url: r.links?.self_html || '#'
                }));
            } catch(e) { return []; }
        }

        async function searchCORE(query) {
            try {
                const url = `https://api.core.ac.uk/v1/search/${encodeURIComponent(query)}?limit=2`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.data || []).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'CORE aggregated research',
                    source: 'CORE',
                    url: r.url || '#'
                }));
            } catch(e) { return []; }
        }

        async function searchBioRxiv(query) {
            try {
                const url = `https://www.biorxiv.org/search/${encodeURIComponent(query)}?format=json&limit=2`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.docs || []).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'bioRxiv preprint',
                    source: 'bioRxiv',
                    url: `https://www.biorxiv.org/content/${r.biorxiv_id}v1`
                }));
            } catch(e) { return []; }
        }

        async function searchMedRxiv(query) {
            try {
                const url = `https://www.medrxiv.org/search/${encodeURIComponent(query)}?format=json&limit=2`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.docs || []).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'medRxiv preprint',
                    source: 'medRxiv',
                    url: `https://www.medrxiv.org/content/${r.medrxiv_id}v1`
                }));
            } catch(e) { return []; }
        }

        async function searchPLOS(query) {
            try {
                const url = `https://api.plos.org/search?q=${encodeURIComponent(query)}&rows=2&wt=json`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.response?.docs || []).map(r => ({
                    title: r.title_display,
                    snippet: r.abstract_primary || 'PLOS open access research',
                    source: 'PLOS',
                    url: r.id
                }));
            } catch(e) { return []; }
        }

        async function searchIEEE(query) {
            try {
                const url = `https://ieeexplore.ieee.org/iel7/search/searchresult.jsp?queryText=${encodeURIComponent(query)}&pageNumber=1&pageSize=2`;
                const response = await fetch(url);
                const data = await response.json();
                return (data.records || []).map(r => ({
                    title: r.title,
                    snippet: r.abstract || 'IEEE technical publication',
                    source: 'IEEE Xplore',
                    url: r.url
                }));
            } catch(e) { return []; }
        }

        function synthesizeAnswer(query, results) {
            if (results.length === 0) {
                return 'No sources found. Try a different query.';
            }

            // Score sentences by relevance using TF-IDF-like approach
            const queryTerms = query.toLowerCase().split(/\s+/).filter(t => t.length > 3);
            const sentences = extractSentences(results);
            const scoredSentences = sentences.map(sent => ({
                text: sent,
                score: calculateScore(sent, queryTerms)
            }));

            // Get top sentences
            const topSentences = scoredSentences
                .sort((a, b) => b.score - a.score)
                .slice(0, 5)
                .filter(s => s.score > 0);

            // Reorder by appearance
            const reordered = topSentences.sort((a, b) => 
                sentences.indexOf(a.text) - sentences.indexOf(b.text)
            );

            const answer = reordered.map(s => s.text).join(' ');
            
            return answer || `Research indicates this topic is covered across ${results.length} sources in academic literature. The sources provide multiple perspectives and findings related to your query.`;
        }

        function extractSentences(results) {
            const sentences = [];
            results.forEach(r => {
                const text = r.snippet || r.title;
                const parts = text.split(/[.!?]+/).filter(s => s.trim().length > 10);
                sentences.push(...parts.map(p => p.trim()));
            });
            return sentences.slice(0, 20);
        }

        function calculateScore(sentence, queryTerms) {
            let score = 0;
            const lowerSent = sentence.toLowerCase();
            
            queryTerms.forEach(term => {
                if (lowerSent.includes(term)) {
                    score += 1;
                }
            });

            // Boost for research keywords
            const researchKeywords = ['research', 'study', 'findings', 'results', 'data', 'analysis', 'effect', 'significant', 'demonstrates'];
            researchKeywords.forEach(kw => {
                if (lowerSent.includes(kw)) score += 0.5;
            });

            // Penalty for short sentences
            if (sentence.length < 30) score *= 0.7;

            return score;
        }

        function generateFrameworkChecks() {
            const checks = [];
            Object.entries(BIAS_FRAMEWORK).forEach(([cat, items]) => {
                const randomItem = items[Math.floor(Math.random() * items.length)];
                checks.push(`[${cat}] ${randomItem}`);
            });
            return checks;
        }

        function displayResults(results, synthesizedAnswer, frameworkChecks) {
            // Answer
            document.getElementById('synthesizedAnswer').innerHTML = `<p>${synthesizedAnswer}</p>`;
            document.getElementById('sourceCount').innerHTML = `<p>Based on ${results.length} sources</p>`;

            // Sources
            let sourcesHtml = '';
            const sourcesByType = {};
            results.forEach(r => {
                sourcesByType[r.source] = (sourcesByType[r.source] || 0) + 1;
                sourcesHtml += `
                    <div class="source-item">
                        <span class="source-badge">${r.source}</span>
                        <strong>${r.title}</strong>
                        <p>${r.snippet.substring(0, 200)}${r.snippet.length > 200 ? '...' : ''}</p>
                        <a href="${r.url}" target="_blank">View source →</a>
                    </div>
                `;
            });
            
            document.getElementById('primarySources').innerHTML = sourcesHtml;

            // Framework
            const frameworkHtml = frameworkChecks.map(c => `<li>${c}</li>`).join('');
            document.getElementById('frameworkItems').innerHTML = frameworkHtml;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') performResearch();
        }
    </script>
</body>
</html>